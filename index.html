<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ronde de S√©curit√©</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 15px; background: #f4f7f6; }
        .item { background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #ddd; }
        .btns { display: flex; gap: 10px; margin-top: 10px; }
        button { padding: 10px 20px; border-radius: 5px; border: 1px solid #ccc; cursor: pointer; font-weight: bold; }
        .ok.active { background: #27ae60; color: white; }
        .bad.active { background: #e74c3c; color: white; }
        .defect-area { display: none; margin-top: 10px; border-top: 1px dashed #e74c3c; padding-top: 10px; }
        textarea { width: 100%; height: 60px; margin-top: 5px; }
        #sig { border: 2px dashed #999; width: 100%; height: 150px; background: #fff; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>üöõ Ronde de S√©curit√©</h1>
    <input type="text" id="driver" placeholder="Nom du Chauffeur" style="width:100%; padding:10px; margin-bottom:10px;">
    <input type="text" id="unit" placeholder="Camion #" style="width:100%; padding:10px; margin-bottom:10px;">

    <div id="checklist"></div>

    <div class="item">
        <h3>‚úçÔ∏è Signature</h3>
        <canvas id="sig"></canvas>
        <button onclick="clearSig()">Effacer</button>
    </div>

    <button onclick="submitForm()" style="width:100%; padding:20px; background:#27ae60; color:white; font-size:1.2rem;">SOUMETTRE</button>

    <div id="confirm" style="display:none; text-align:center; padding:20px;">
        <h2>‚úÖ ENVOY√â</h2>
        <button onclick="downloadPDF()" style="background:#e67e22; color:white; padding:15px; width:100%;">T√âL√âCHARGER LE PDF</button>
    </div>

    <script>
        const tasks = ["Freins", "Pneus", "Lumi√®res", "Direction", "Attelage", "Niveaux d'huile", "Miroirs", "Essuie-glaces"];
        const checklist = document.getElementById('checklist');
        let results = {};

        tasks.forEach(t => {
            const div = document.createElement('div');
            div.className = 'item';
            div.innerHTML = `<strong>${t}</strong><div class="btns">
                <button onclick="setStatus('${t}','OK',this)" class="ok">OK</button>
                <button onclick="setStatus('${t}','X',this)" class="bad">X</button>
            </div>
            <div id="area-${t}" class="defect-area">
                <textarea placeholder="D√©tails du probl√®me..."></textarea>
                <input type="file" accept="image/*" capture="camera">
            </div>`;
            checklist.appendChild(div);
        });

        function setStatus(t, s, btn) {
            btn.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            results[t] = s;
            document.getElementById('area-'+t).style.display = (s === 'X') ? 'block' : 'none';
        }

        const canvas = document.getElementById('sig');
        const ctx = canvas.getContext('2d');
        canvas.width = canvas.offsetWidth;
        canvas.height = 150;
        let drawing = false;
        canvas.onmousedown = canvas.ontouchstart = (e) => { drawing = true; ctx.beginPath(); };
        canvas.onmouseup = canvas.ontouchend = () => { drawing = false; };
        canvas.onmousemove = canvas.ontouchmove = (e) => {
            if(!drawing) return;
            const r = canvas.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - r.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - r.top;
            ctx.lineTo(x, y); ctx.stroke();
        };
        function clearSig() { ctx.clearRect(0,0,canvas.width,canvas.height); }

        function submitForm() {
            document.getElementById('confirm').style.display = 'block';
            window.scrollTo(0, document.body.scrollHeight);
        }

        function downloadPDF() {
            const element = document.body;
            html2pdf().from(element).save('Inspection.pdf');
        }
    </script>
</body>
</html>
